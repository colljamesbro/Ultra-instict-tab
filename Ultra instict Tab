local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

-- Variables
local ultraInstinctActive = false
local autoLockActive = false
local espActive = false
local password = "Colljamesbro"

-- Create UI
local screenGui = Instance.new("ScreenGui")
screenGui.Parent = game:GetService("CoreGui")
screenGui.Name = "FancyUltraInstinctGui"

-- Password Input Frame
local passwordFrame = Instance.new("Frame")
passwordFrame.Parent = screenGui
passwordFrame.Size = UDim2.new(0, 300, 0, 150)
passwordFrame.Position = UDim2.new(0.5, -150, 0.5, -75)
passwordFrame.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
passwordFrame.Visible = true

local passwordLabel = Instance.new("TextLabel")
passwordLabel.Parent = passwordFrame
passwordLabel.Size = UDim2.new(1, 0, 0.3, 0)
passwordLabel.Position = UDim2.new(0, 0, 0, 10)
passwordLabel.Text = "Enter Password:"
passwordLabel.TextSize = 20
passwordLabel.Font = Enum.Font.SourceSans
passwordLabel.TextColor3 = Color3.new(1, 1, 1)
passwordLabel.BackgroundTransparency = 1

local passwordInput = Instance.new("TextBox")
passwordInput.Parent = passwordFrame
passwordInput.Size = UDim2.new(0.8, 0, 0.2, 0)
passwordInput.Position = UDim2.new(0.1, 0, 0.4, 0)
passwordInput.Text = ""
passwordInput.PlaceholderText = "Enter password here"
passwordInput.Font = Enum.Font.SourceSans
passwordInput.TextSize = 18
passwordInput.TextColor3 = Color3.new(0, 0, 0)
passwordInput.BackgroundColor3 = Color3.new(1, 1, 1)

local submitButton = Instance.new("TextButton")
submitButton.Parent = passwordFrame
submitButton.Size = UDim2.new(0.4, 0, 0.2, 0)
submitButton.Position = UDim2.new(0.3, 0, 0.7, 0)
submitButton.Text = "Submit"
submitButton.Font = Enum.Font.SourceSans
submitButton.TextSize = 18
submitButton.TextColor3 = Color3.new(1, 1, 1)
submitButton.BackgroundColor3 = Color3.new(0.3, 0.3, 0.3)

-- Side Tab
local sideTab = Instance.new("Frame")
sideTab.Parent = screenGui
sideTab.Size = UDim2.new(0, 200, 0, 300)
sideTab.Position = UDim2.new(1, -220, 0.5, -150)
sideTab.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
sideTab.Visible = false

-- Blue "J" in the background
local blueJ = Instance.new("TextLabel")
blueJ.Parent = sideTab
blueJ.Size = UDim2.new(1, 0, 1, 0)
blueJ.Position = UDim2.new(0, 0, 0, 0)
blueJ.Text = "J"
blueJ.Font = Enum.Font.SourceSansBold
blueJ.TextSize = 150
blueJ.TextColor3 = Color3.new(0, 0.5, 1)
blueJ.TextTransparency = 0.8
blueJ.BackgroundTransparency = 1

-- Toggle Buttons
local buttons = {}

local function createButton(name, position, defaultColor)
    local button = Instance.new("TextButton")
    button.Parent = sideTab
    button.Size = UDim2.new(0.8, 0, 0.2, 0)
    button.Position = UDim2.new(0.1, 0, position, 0)
    button.Text = name
    button.Font = Enum.Font.SourceSans
    button.TextSize = 18
    button.TextColor3 = Color3.new(1, 1, 1)
    button.BackgroundColor3 = defaultColor
    buttons[name] = button
    return button
end

local ultraInstinctButton = createButton("Ultra Instinct", 0.1, Color3.new(1, 0, 0))
local autoLockButton = createButton("Auto Lock", 0.35, Color3.new(1, 0, 0))
local espButton = createButton("ESP", 0.6, Color3.new(1, 0, 0))

-- Toggle Functions
local function toggleFeature(button, feature)
    if feature == "Ultra Instinct" then
        ultraInstinctActive = not ultraInstinctActive
        button.BackgroundColor3 = ultraInstinctActive and Color3.new(0, 1, 0) or Color3.new(1, 0, 0)
    elseif feature == "Auto Lock" then
        autoLockActive = not autoLockActive
        button.BackgroundColor3 = autoLockActive and Color3.new(0, 1, 0) or Color3.new(1, 0, 0)
    elseif feature == "ESP" then
        espActive = not espActive
        button.BackgroundColor3 = espActive and Color3.new(0, 1, 0) or Color3.new(1, 0, 0)
        if espActive then
            -- ESP logic
            for _, player in pairs(Players:GetPlayers()) do
                if player ~= LocalPlayer then
                    local highlight = Instance.new("Highlight", player.Character or player.CharacterAdded:Wait())
                    highlight.FillColor = Color3.new(1, 0, 0)
                end
            end
        else
            -- Remove ESP
            for _, player in pairs(Players:GetPlayers()) do
                if player.Character then
                    for _, child in pairs(player.Character:GetChildren()) do
                        if child:IsA("Highlight") then
                            child:Destroy()
                        end
                    end
                end
            end
        end
    end
end

ultraInstinctButton.MouseButton1Click:Connect(function()
    toggleFeature(ultraInstinctButton, "Ultra Instinct")
end)

autoLockButton.MouseButton1Click:Connect(function()
    toggleFeature(autoLockButton, "Auto Lock")
end)

espButton.MouseButton1Click:Connect(function()
    toggleFeature(espButton, "ESP")
end)

-- Submit Password
submitButton.MouseButton1Click:Connect(function()
    if passwordInput.Text == password then
        passwordFrame.Visible = false
        sideTab.Visible = true
    else
        passwordLabel.Text = "Incorrect Password! Try Again."
        passwordLabel.TextColor3 = Color3.new(1, 0, 0)
    end
end)

-- Teleport Behind Attacker
local function teleportBehind(attacker)
    if not ultraInstinctActive or not attacker then
        return
    end

    local attackerCharacter = attacker.Character
    local localCharacter = LocalPlayer.Character
    if attackerCharacter and localCharacter then
        local attackerRoot = attackerCharacter:FindFirstChild("HumanoidRootPart")
        local localRoot = localCharacter:FindFirstChild("HumanoidRootPart")
        if attackerRoot and localRoot then
            local positionBehind = attackerRoot.Position - attackerRoot.CFrame.LookVector * 5
            localRoot.CFrame = CFrame.new(positionBehind)
        end
    end
end

-- Monitor Hits
local function monitorHits()
    local character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
    local humanoid = character:WaitForChild("Humanoid")
    local currentHealth = humanoid.Health

    humanoid:GetPropertyChangedSignal("Health"):Connect(function()
        if humanoid.Health < currentHealth then
            local lastAttacker = nil -- Replace with logic to detect attacker
            teleportBehind(lastAttacker)
        end
        currentHealth = humanoid.Health
    end)
end

LocalPlayer.CharacterAdded:Connect(monitorHits)
if LocalPlayer.Character then
    monitorHits()
end
